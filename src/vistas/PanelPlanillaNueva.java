/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package vistas;

import Atxy2k.CustomTextField.RestrictedTextField;
import com.toedter.calendar.JTextFieldDateEditor;
import modelo.ComboItem;
import controladores.ControladorPrincipal;
import java.awt.Font;
import java.awt.event.ItemEvent;

import java.awt.event.ItemListener;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;
import java.sql.Types;

import java.util.Date;
import javax.swing.JLabel;

import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;
import modelo.JLabelAriel;

/**
 *
 * @author ari_0
 */
public class PanelPlanillaNueva extends JPanelCustom {

    private DefaultTableModel tablaReparaciones, modeloPagos;
    ControladorPrincipal controlador;
    RestrictedTextField montoCheque, montoContado;
    ItemListener itemListennerCli, itemListennerVh, itemListennerPersona;
    private String nombre, apellido, apodo;
    ;
    private int idCliente = 0; //El id de cliente que se va a guardar

    public PanelPlanillaNueva() {
//--------------------------------------
        prepararModelosTablas(); //Prepara las tablas con sus respectivos encabezados de columna
        initComponents();
        cosasParaIniciarEnComun(); //Algunas variables de las vistas y el controlador
        //Este método va acá porque difiere de la planilla a modificar
        cargarPersonas("0"); // El 0 representa el id de la persona: como no tiene id va 0
        this.jComboBoxPersona.setSelectedIndex(1);
        paraIniciarPlanillaNueva(); //Para planillas Nuevas
        // guardarPlanilla();
    }

    PanelPlanillaNueva(int numero) { //Constructor para planillas a modificar por eso tiene numero
        //Número que representa el idplanilla, usado en la vista "Ver planillas" para cuando se quiera modificar una
        //Por esto algunas funciones desaparecen "setVisible(false)"
        //   tablaReparaciones = new DefaultTableModel();
        prepararModelosTablas();
        initComponents();
        cosasParaIniciarEnComun();
        cosasParaPlanillaAModificar(numero);
    }

    private void cosasParaIniciarEnComun() {
        this.jTableReparaciones.getColumnModel().getColumn(0).setPreferredWidth(450);
        this.jFrameContado.setLocationRelativeTo(null);
        this.jFrameCheque.setLocationRelativeTo(null);
        desactivoEdicionTextFieldDeDateChooser();
        controlador = ControladorPrincipal.getInstancia();
    }

    private void desactivoEdicionTextFieldDeDateChooser() {
        JTextFieldDateEditor editor = (JTextFieldDateEditor) this.jDateChooserEntrada.getDateEditor();
        editor.setEditable(false);
        editor = (JTextFieldDateEditor) this.jDateChooserSalida.getDateEditor();
        editor.setEditable(false);
        //Faltan
    }

    private String[] getColumnas() {
        String columna[] = new String[]{"Reparación", "tipo", "Importe", "Finalizada"};
        return columna;
    }

    private String[] getColumnasPagos() {
        String columna[] = new String[]{"id", "tipo", "monto", "¿cobrado?"};
        return columna;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel3 = new javax.swing.JLabel();
        jFrameContado = new javax.swing.JFrame();
        jButtonAgregarContado = new javax.swing.JButton();
        jButtonCancelar = new javax.swing.JButton();
        jTextFieldMontoContado = new javax.swing.JTextField();
        jLabel6 = new javax.swing.JLabel();
        jDateChooserContado = new com.toedter.calendar.JDateChooser();
        jLabel7 = new javax.swing.JLabel();
        jRadioButtonNuevoPago = new javax.swing.JRadioButton();
        jLabel23 = new javax.swing.JLabel();
        jLabelId = new javax.swing.JLabel();
        jLabelIdPago = new javax.swing.JLabel();
        jFrameCheque = new javax.swing.JFrame();
        jLabel8 = new javax.swing.JLabel();
        jLabel11 = new javax.swing.JLabel();
        jLabel12 = new javax.swing.JLabel();
        jTextFieldMontoCheque = new javax.swing.JTextField();
        jButtonAgregarCheque = new javax.swing.JButton();
        jButtonCancelarCheque = new javax.swing.JButton();
        jLabel13 = new javax.swing.JLabel();
        jTextFieldNCheque = new javax.swing.JTextField();
        jDateChooserChCobro = new com.toedter.calendar.JDateChooser();
        jDateChooserChEmision = new com.toedter.calendar.JDateChooser();
        jCheckBoxChCobrado = new javax.swing.JCheckBox();
        jLabel14 = new javax.swing.JLabel();
        jCheckBoxChequeNuevo = new javax.swing.JCheckBox();
        jLabelIdCheque = new javax.swing.JLabel();
        jFrameEstadoPagos = new javax.swing.JFrame();
        jLabel15 = new javax.swing.JLabel();
        jLabel16 = new javax.swing.JLabel();
        jTextFieldImporteTotal = new javax.swing.JTextField();
        jTextFieldCC = new javax.swing.JTextField();
        jButtonAceptarDeudas = new javax.swing.JButton();
        jLabel19 = new javax.swing.JLabel();
        jTextFieldMontoPagado = new javax.swing.JTextField();
        jLabel20 = new javax.swing.JLabel();
        jDateChooserFEntrega = new com.toedter.calendar.JDateChooser();
        jLabel17 = new javax.swing.JLabel();
        jLabel21 = new javax.swing.JLabel();
        jLabel22 = new javax.swing.JLabel();
        jTextFieldACobrar = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        buttonGroupNPago = new javax.swing.ButtonGroup();
        buttonGroupAModif = new javax.swing.ButtonGroup();
        jLabelFechaPl = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        jTableReparaciones = new javax.swing.JTable();
        jLabel2 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabelNumPlanilla = new javax.swing.JLabel();
        jButtonAdRep = new javax.swing.JButton();
        jButtonQuitar = new javax.swing.JButton();
        jLabelVh = new javax.swing.JLabel();
        jComboBoxVh = new javax.swing.JComboBox<>();
        jLabelFPatente = new javax.swing.JLabel();
        jTextFieldFPatente = new javax.swing.JTextField();
        jLabel9 = new javax.swing.JLabel();
        jTextFieldDescripcion = new javax.swing.JTextField();
        jButtonPagoContado = new javax.swing.JButton();
        jButtonCancel = new javax.swing.JButton();
        jButtonGuardar = new javax.swing.JButton();
        jButtonFVh = new javax.swing.JButton();
        jLabel10 = new javax.swing.JLabel();
        jButtonVerPago = new javax.swing.JButton();
        jCheckBoxPagado = new javax.swing.JCheckBox();
        jCheckBoxEntregado = new javax.swing.JCheckBox();
        jLabel5 = new javax.swing.JLabel();
        jDateChooserSalida = new com.toedter.calendar.JDateChooser();
        jScrollPane2 = new javax.swing.JScrollPane();
        jTablePagos = new javax.swing.JTable();
        jCheckBoxFacturado = new javax.swing.JCheckBox();
        jButtonPagoCheque = new javax.swing.JButton();
        jFrameDeudaPlanilla = new javax.swing.JButton();
        jLabelChofer = new javax.swing.JLabel();
        jComboBoxPersona = new javax.swing.JComboBox<>();
        jTextFieldFPersona = new javax.swing.JTextField();
        jLabelNombreApodo = new javax.swing.JLabel();
        jButtonFPer = new javax.swing.JButton();
        jLabelCliente = new javax.swing.JLabel();
        jTextFieldDueñoCliente = new javax.swing.JTextField();
        jDateChooserEntrada = new com.toedter.calendar.JDateChooser();
        jButtonBorrarPago = new javax.swing.JButton();

        jLabel3.setText("jLabel3");

        jFrameContado.setAlwaysOnTop(true);
        jFrameContado.setLocationByPlatform(true);
        jFrameContado.setResizable(false);
        jFrameContado.setSize(new java.awt.Dimension(435, 265));
        jFrameContado.setType(java.awt.Window.Type.POPUP);

        jButtonAgregarContado.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonAgregarContado.setText("Agregar");
        jButtonAgregarContado.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonAgregarContadoActionPerformed(evt);
            }
        });

        jButtonCancelar.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonCancelar.setText("Cancelar");
        jButtonCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonCancelarActionPerformed(evt);
            }
        });

        jTextFieldMontoContado.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N

        jLabel6.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel6.setText("Monto del pago:");

        jDateChooserContado.setFont(new java.awt.Font("SansSerif", 0, 16)); // NOI18N

        jLabel7.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel7.setText("Fecha:");

        buttonGroupNPago.add(jRadioButtonNuevoPago);
        jRadioButtonNuevoPago.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jRadioButtonNuevoPago.setText("Nuevo Pago");

        jLabel23.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jLabel23.setText("A Modificar o Nuevo:");

        jLabelId.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jLabelId.setText("idPago:");

        jLabelIdPago.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jLabelIdPago.setText("??");

        javax.swing.GroupLayout jFrameContadoLayout = new javax.swing.GroupLayout(jFrameContado.getContentPane());
        jFrameContado.getContentPane().setLayout(jFrameContadoLayout);
        jFrameContadoLayout.setHorizontalGroup(
            jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jFrameContadoLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(jFrameContadoLayout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(jButtonCancelar)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jButtonAgregarContado))
                    .addGroup(jFrameContadoLayout.createSequentialGroup()
                        .addGroup(jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel6)
                            .addComponent(jLabel7)
                            .addComponent(jLabel23)
                            .addComponent(jLabelId))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabelIdPago)
                            .addGroup(jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(jTextFieldMontoContado, javax.swing.GroupLayout.PREFERRED_SIZE, 206, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(jDateChooserContado, javax.swing.GroupLayout.PREFERRED_SIZE, 144, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addComponent(jRadioButtonNuevoPago, javax.swing.GroupLayout.Alignment.TRAILING)))
                        .addGap(0, 20, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jFrameContadoLayout.setVerticalGroup(
            jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jFrameContadoLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jRadioButtonNuevoPago)
                    .addComponent(jLabel23))
                .addGap(18, 18, 18)
                .addGroup(jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabelId)
                    .addComponent(jLabelIdPago))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 27, Short.MAX_VALUE)
                .addGroup(jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jFrameContadoLayout.createSequentialGroup()
                        .addGroup(jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jTextFieldMontoContado, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel6))
                        .addGap(18, 18, 18)
                        .addComponent(jDateChooserContado, javax.swing.GroupLayout.PREFERRED_SIZE, 33, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jLabel7))
                .addGap(18, 18, 18)
                .addGroup(jFrameContadoLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButtonAgregarContado)
                    .addComponent(jButtonCancelar))
                .addContainerGap())
        );

        jFrameCheque.setResizable(false);
        jFrameCheque.setSize(new java.awt.Dimension(555, 385));
        jFrameCheque.setType(java.awt.Window.Type.POPUP);

        jLabel8.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel8.setText("Fecha de Cobro:");

        jLabel11.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel11.setText("* Fecha de Emisión:");

        jLabel12.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel12.setText("Monto:");

        jTextFieldMontoCheque.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N

        jButtonAgregarCheque.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonAgregarCheque.setText("Agregar");
        jButtonAgregarCheque.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonAgregarChequeActionPerformed(evt);
            }
        });

        jButtonCancelarCheque.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonCancelarCheque.setText("Cancelar");
        jButtonCancelarCheque.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonCancelarChequeActionPerformed(evt);
            }
        });

        jLabel13.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel13.setText("Número de Cheque:");

        jTextFieldNCheque.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N

        jDateChooserChCobro.setFont(new java.awt.Font("SansSerif", 0, 16)); // NOI18N

        jDateChooserChEmision.setFont(new java.awt.Font("SansSerif", 0, 16)); // NOI18N

        jCheckBoxChCobrado.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jCheckBoxChCobrado.setText("Cobrado");

        jLabel14.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel14.setText("Para indicar si el cheque fue acreditado");

        jCheckBoxChequeNuevo.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jCheckBoxChequeNuevo.setText("Cheque Nuevo");

        jLabelIdCheque.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jLabelIdCheque.setText("idCheque");

        javax.swing.GroupLayout jFrameChequeLayout = new javax.swing.GroupLayout(jFrameCheque.getContentPane());
        jFrameCheque.getContentPane().setLayout(jFrameChequeLayout);
        jFrameChequeLayout.setHorizontalGroup(
            jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jFrameChequeLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jFrameChequeLayout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addGroup(jFrameChequeLayout.createSequentialGroup()
                                .addComponent(jLabel14)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jCheckBoxChCobrado))
                            .addGroup(jFrameChequeLayout.createSequentialGroup()
                                .addComponent(jButtonCancelarCheque)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jButtonAgregarCheque))))
                    .addGroup(jFrameChequeLayout.createSequentialGroup()
                        .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jFrameChequeLayout.createSequentialGroup()
                                    .addComponent(jLabel12)
                                    .addGap(123, 123, 123)
                                    .addComponent(jTextFieldMontoCheque))
                                .addGroup(jFrameChequeLayout.createSequentialGroup()
                                    .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                        .addGroup(jFrameChequeLayout.createSequentialGroup()
                                            .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                                .addComponent(jLabel8)
                                                .addComponent(jLabel11))
                                            .addGap(18, 18, 18))
                                        .addGroup(javax.swing.GroupLayout.Alignment.LEADING, jFrameChequeLayout.createSequentialGroup()
                                            .addComponent(jLabelIdCheque)
                                            .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)))
                                    .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                        .addComponent(jDateChooserChEmision, javax.swing.GroupLayout.PREFERRED_SIZE, 136, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jDateChooserChCobro, javax.swing.GroupLayout.PREFERRED_SIZE, 136, javax.swing.GroupLayout.PREFERRED_SIZE)
                                        .addComponent(jCheckBoxChequeNuevo))))
                            .addGroup(jFrameChequeLayout.createSequentialGroup()
                                .addComponent(jLabel13)
                                .addGap(18, 18, 18)
                                .addComponent(jTextFieldNCheque, javax.swing.GroupLayout.PREFERRED_SIZE, 333, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );
        jFrameChequeLayout.setVerticalGroup(
            jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jFrameChequeLayout.createSequentialGroup()
                .addContainerGap(26, Short.MAX_VALUE)
                .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jCheckBoxChequeNuevo)
                    .addComponent(jLabelIdCheque))
                .addGap(18, 18, 18)
                .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel8)
                    .addComponent(jDateChooserChCobro, javax.swing.GroupLayout.PREFERRED_SIZE, 33, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jDateChooserChEmision, javax.swing.GroupLayout.PREFERRED_SIZE, 33, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel11))
                .addGap(18, 18, 18)
                .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel12)
                    .addComponent(jTextFieldMontoCheque, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel13)
                    .addComponent(jTextFieldNCheque, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jCheckBoxChCobrado)
                    .addComponent(jLabel14))
                .addGap(18, 18, 18)
                .addGroup(jFrameChequeLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jButtonAgregarCheque)
                    .addComponent(jButtonCancelarCheque))
                .addContainerGap())
        );

        jFrameEstadoPagos.setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        jFrameEstadoPagos.setLocationByPlatform(true);
        jFrameEstadoPagos.setResizable(false);
        jFrameEstadoPagos.setSize(new java.awt.Dimension(740, 435));
        jFrameEstadoPagos.setType(java.awt.Window.Type.POPUP);

        jLabel15.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jLabel15.setText("Importe Total Reparaciones:");
        jLabel15.setMaximumSize(new java.awt.Dimension(404, 450));
        jLabel15.setMinimumSize(new java.awt.Dimension(224, 250));

        jLabel16.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jLabel16.setText("Cantidad que falta pagar:");

        jTextFieldImporteTotal.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N

        jTextFieldCC.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N

        jButtonAceptarDeudas.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonAceptarDeudas.setText("Aceptar");
        jButtonAceptarDeudas.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonAceptarDeudasActionPerformed(evt);
            }
        });

        jLabel19.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jLabel19.setText("Total recibido:");
        jLabel19.setMaximumSize(new java.awt.Dimension(404, 450));
        jLabel19.setMinimumSize(new java.awt.Dimension(224, 250));

        jTextFieldMontoPagado.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N

        jLabel20.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel20.setText("Fecha de Entrega:");

        jDateChooserFEntrega.setFont(new java.awt.Font("SansSerif", 0, 16)); // NOI18N
        jDateChooserFEntrega.setMinimumSize(new java.awt.Dimension(155, 27));

        jLabel17.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel17.setText("Estado de Cuenta Corriente:");

        jLabel21.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel21.setForeground(new java.awt.Color(255, 0, 0));
        jLabel21.setText("45 días sin pagar");

        jLabel22.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jLabel22.setText("Monto a Cobrar (Cheques):");

        jTextFieldACobrar.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N

        jLabel1.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jLabel1.setText("*El \"Total Recibido\" incluye los cheques que aún no fueron cobrados");

        javax.swing.GroupLayout jFrameEstadoPagosLayout = new javax.swing.GroupLayout(jFrameEstadoPagos.getContentPane());
        jFrameEstadoPagos.getContentPane().setLayout(jFrameEstadoPagosLayout);
        jFrameEstadoPagosLayout.setHorizontalGroup(
            jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jFrameEstadoPagosLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jFrameEstadoPagosLayout.createSequentialGroup()
                        .addGap(0, 0, Short.MAX_VALUE)
                        .addComponent(jButtonAceptarDeudas))
                    .addGroup(jFrameEstadoPagosLayout.createSequentialGroup()
                        .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jLabel15, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jLabel20))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jTextFieldImporteTotal)
                            .addGroup(jFrameEstadoPagosLayout.createSequentialGroup()
                                .addComponent(jDateChooserFEntrega, javax.swing.GroupLayout.PREFERRED_SIZE, 180, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(0, 0, Short.MAX_VALUE))))
                    .addGroup(jFrameEstadoPagosLayout.createSequentialGroup()
                        .addComponent(jLabel19, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(123, 123, 123)
                        .addComponent(jTextFieldMontoPagado))
                    .addGroup(jFrameEstadoPagosLayout.createSequentialGroup()
                        .addComponent(jLabel16)
                        .addGap(36, 36, 36)
                        .addComponent(jTextFieldCC))
                    .addGroup(jFrameEstadoPagosLayout.createSequentialGroup()
                        .addComponent(jLabel22)
                        .addGap(18, 18, 18)
                        .addComponent(jTextFieldACobrar)))
                .addContainerGap())
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jFrameEstadoPagosLayout.createSequentialGroup()
                .addContainerGap(25, Short.MAX_VALUE)
                .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jLabel1)
                    .addGroup(jFrameEstadoPagosLayout.createSequentialGroup()
                        .addComponent(jLabel17)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel21)))
                .addGap(172, 172, 172))
        );
        jFrameEstadoPagosLayout.setVerticalGroup(
            jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jFrameEstadoPagosLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addComponent(jLabel20)
                    .addComponent(jDateChooserFEntrega, javax.swing.GroupLayout.PREFERRED_SIZE, 33, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel15, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTextFieldImporteTotal, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel19, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jTextFieldMontoPagado, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel16)
                    .addComponent(jTextFieldCC, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel22)
                    .addComponent(jTextFieldACobrar, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(13, 13, 13)
                .addGroup(jFrameEstadoPagosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel21)
                    .addComponent(jLabel17))
                .addGap(18, 18, 18)
                .addComponent(jLabel1)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jButtonAceptarDeudas)
                .addContainerGap())
        );

        jLabelFechaPl.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabelFechaPl.setText("Fecha Entrada:");

        jScrollPane1.setPreferredSize(new java.awt.Dimension(0, 0));

        jTableReparaciones.setAutoCreateRowSorter(true);
        jTableReparaciones.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N
        jTableReparaciones.setModel(tablaReparaciones);
        jScrollPane1.setViewportView(jTableReparaciones);

        jLabel2.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel2.setText("Reparaciones ▼");

        jLabel4.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel4.setText("Planilla N°:");

        jLabelNumPlanilla.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabelNumPlanilla.setText("000000");

        jButtonAdRep.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jButtonAdRep.setText("Agregar Reparación");
        jButtonAdRep.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonAdRepActionPerformed(evt);
            }
        });

        jButtonQuitar.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonQuitar.setText("Quitar Reparación");
        jButtonQuitar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonQuitarActionPerformed(evt);
            }
        });

        jLabelVh.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabelVh.setText("Camión:");

        jComboBoxVh.setFont(new java.awt.Font("Segoe UI Semibold", 0, 20)); // NOI18N

        jLabelFPatente.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabelFPatente.setText("Filtrar por patente:");

        jTextFieldFPatente.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jTextFieldFPatente.setToolTipText("ABC123CD ó ABC123");

        jLabel9.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel9.setText("Descripción:");

        jTextFieldDescripcion.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N

        jButtonPagoContado.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jButtonPagoContado.setText("Agregar Pago Contado");
        jButtonPagoContado.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonPagoContadoActionPerformed(evt);
            }
        });

        jButtonCancel.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonCancel.setText("Cancelar");
        jButtonCancel.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonCancelActionPerformed(evt);
            }
        });

        jButtonGuardar.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonGuardar.setText("Guardar");
        jButtonGuardar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonGuardarActionPerformed(evt);
            }
        });

        jButtonFVh.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonFVh.setText("Filtrar");
        //this.jButtonFVh.setEnabled(false);
        jButtonFVh.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonFVhActionPerformed(evt);
            }
        });

        jLabel10.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel10.setText("Pagos:");

        jButtonVerPago.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonVerPago.setText("Ver Pago");
        jButtonVerPago.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonVerPagoActionPerformed(evt);
            }
        });

        jCheckBoxPagado.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jCheckBoxPagado.setText("Planilla Paga");

        jCheckBoxEntregado.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jCheckBoxEntregado.setText("Entregado -");

        jLabel5.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabel5.setText("Fecha:");

        jDateChooserSalida.setFont(new java.awt.Font("SansSerif", 0, 16)); // NOI18N
        jDateChooserSalida.setMinimumSize(new java.awt.Dimension(155, 27));

        jScrollPane2.setFont(new java.awt.Font("Tahoma", 0, 14)); // NOI18N

        jTablePagos.setFont(new java.awt.Font("SansSerif", 0, 14)); // NOI18N
        jTablePagos.setModel(modeloPagos);
        jScrollPane2.setViewportView(jTablePagos);

        jCheckBoxFacturado.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jCheckBoxFacturado.setText("Facturado");
        jCheckBoxFacturado.setToolTipText("Cuando se activa empieza la Cuenta Corriente");

        jButtonPagoCheque.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jButtonPagoCheque.setText("Agregar Cheque");
        jButtonPagoCheque.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonPagoChequeActionPerformed(evt);
            }
        });

        jFrameDeudaPlanilla.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jFrameDeudaPlanilla.setText("Ver Estado de CC");
        jFrameDeudaPlanilla.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jFrameDeudaPlanillaActionPerformed(evt);
            }
        });

        jLabelChofer.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabelChofer.setText("Traído por:");

        jComboBoxPersona.setFont(new java.awt.Font("Segoe UI Semibold", 0, 18)); // NOI18N

        jTextFieldFPersona.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N

        jLabelNombreApodo.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabelNombreApodo.setText("Filtrar por Nombre o Apodo:");

        jButtonFPer.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jButtonFPer.setText("Filtrar");
        jButtonFPer.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonFPerActionPerformed(evt);
            }
        });

        jLabelCliente.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jLabelCliente.setText("Dueño o Cliente:");

        jTextFieldDueñoCliente.setEditable(false);
        jTextFieldDueñoCliente.setFont(new java.awt.Font("SansSerif", 0, 18)); // NOI18N
        jTextFieldDueñoCliente.setDisabledTextColor(new java.awt.Color(51, 51, 51));

        jDateChooserEntrada.setFont(new java.awt.Font("SansSerif", 0, 16)); // NOI18N
        jDateChooserEntrada.setMinimumSize(new java.awt.Dimension(155, 27));

        jButtonBorrarPago.setFont(new java.awt.Font("Tahoma", 0, 18)); // NOI18N
        jButtonBorrarPago.setText("Borrar");
        jButtonBorrarPago.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButtonBorrarPagoActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(this);
        this.setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(10, 10, 10)
                .addComponent(jLabel2)
                .addGap(78, 78, 78)
                .addComponent(jLabelChofer)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jComboBoxPersona, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(jLabelNombreApodo)
                .addGap(18, 18, 18)
                .addComponent(jTextFieldFPersona, javax.swing.GroupLayout.PREFERRED_SIZE, 210, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jButtonFPer)
                .addContainerGap())
            .addGroup(layout.createSequentialGroup()
                .addGap(10, 10, 10)
                .addComponent(jLabel9)
                .addGap(10, 10, 10)
                .addComponent(jTextFieldDescripcion)
                .addGap(10, 10, 10)
                .addComponent(jButtonAdRep)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jButtonQuitar)
                .addContainerGap())
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(jLabel10)
                        .addGap(53, 53, 53))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jButtonBorrarPago)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)))
                .addComponent(jScrollPane2)
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jCheckBoxFacturado)
                    .addComponent(jCheckBoxPagado))
                .addGap(40, 40, 40))
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(119, 119, 119)
                        .addComponent(jButtonVerPago)
                        .addGap(6, 6, 6)
                        .addComponent(jButtonPagoContado)
                        .addGap(6, 6, 6)
                        .addComponent(jButtonPagoCheque)
                        .addGap(10, 10, 10)
                        .addComponent(jFrameDeudaPlanilla)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 131, Short.MAX_VALUE)
                        .addComponent(jButtonCancel)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jButtonGuardar))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jLabelVh)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jComboBoxVh, 0, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jLabelFPatente)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jTextFieldFPatente, javax.swing.GroupLayout.PREFERRED_SIZE, 95, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                        .addComponent(jButtonFVh)
                        .addGap(26, 26, 26)
                        .addComponent(jLabelCliente)
                        .addGap(6, 6, 6)
                        .addComponent(jTextFieldDueñoCliente, javax.swing.GroupLayout.PREFERRED_SIZE, 232, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(jLabel4)
                        .addGap(10, 10, 10)
                        .addComponent(jLabelNumPlanilla)
                        .addGap(18, 18, 18)
                        .addComponent(jCheckBoxEntregado)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel5)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jDateChooserSalida, javax.swing.GroupLayout.PREFERRED_SIZE, 172, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(18, 18, 18)
                        .addComponent(jLabelFechaPl)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jDateChooserEntrada, javax.swing.GroupLayout.PREFERRED_SIZE, 172, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(20, 20, 20)
                        .addComponent(jLabel4))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(16, 16, 16)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(jLabelNumPlanilla)
                                    .addComponent(jCheckBoxEntregado)
                                    .addComponent(jLabel5))
                                .addComponent(jDateChooserSalida, javax.swing.GroupLayout.PREFERRED_SIZE, 32, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(1, 1, 1)
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addGroup(layout.createSequentialGroup()
                                        .addGap(3, 3, 3)
                                        .addComponent(jLabelFechaPl))
                                    .addComponent(jDateChooserEntrada, javax.swing.GroupLayout.PREFERRED_SIZE, 33, javax.swing.GroupLayout.PREFERRED_SIZE))))))
                .addGap(8, 8, 8)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabelVh)
                    .addComponent(jComboBoxVh, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabelFPatente)
                    .addComponent(jTextFieldFPatente, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jButtonFVh)
                    .addComponent(jLabelCliente)
                    .addComponent(jTextFieldDueñoCliente, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(11, 11, 11)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(4, 4, 4)
                        .addComponent(jLabel2))
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jComboBoxPersona, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addComponent(jLabelChofer)
                        .addComponent(jLabelNombreApodo))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(1, 1, 1)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jTextFieldFPersona, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jButtonFPer))))
                .addGap(6, 6, 6)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 144, Short.MAX_VALUE)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(jLabel9))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(7, 7, 7)
                        .addComponent(jTextFieldDescripcion, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(6, 6, 6)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(jButtonAdRep)
                            .addComponent(jButtonQuitar))))
                .addGap(18, 18, 18)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 111, Short.MAX_VALUE)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jLabel10)
                                .addGap(25, 25, 25)
                                .addComponent(jButtonBorrarPago))
                            .addGroup(layout.createSequentialGroup()
                                .addGap(13, 13, 13)
                                .addComponent(jCheckBoxFacturado)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(jCheckBoxPagado)))
                        .addGap(0, 27, Short.MAX_VALUE)))
                .addGap(6, 6, 6)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jButtonVerPago)
                    .addComponent(jFrameDeudaPlanilla)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                        .addComponent(jButtonGuardar)
                        .addComponent(jButtonCancel))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(1, 1, 1)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jButtonPagoContado)
                            .addComponent(jButtonPagoCheque)))))
        );
    }// </editor-fold>//GEN-END:initComponents

    private void llenarCampos(int numero) {

        this.jLabelNumPlanilla.setText("" + numero);
        String consulta, nombreApellido, marcaModeloPat;
        Connection co = this.controlador.obtenerConexion();
        //Datos a consultar
        consulta = "select per.nombre, per.apellido, v.marca, v.modelo, v.patente, p.fecha_de_entrada,"
                + " p.fecha_de_salida, p.pagado, p.descripcion from planilla as p inner join persona as per on "
                + " p.idpersona = per.idpersona inner join vehiculo as v on v.idvehiculo = p.idvehiculo "
                + " where p.idplanilla = '" + numero + "'"; //Esta consulta se puede optimizar
        try {
            Statement st = co.createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while (rs.next()) {  //Un solo next porque es una sola planilla
                nombreApellido = rs.getString(1).concat(" " + rs.getString(2));
                marcaModeloPat = rs.getString(3).concat(" " + (rs.getString(4))).concat(": " + (rs.getString(5)));
                this.jCheckBoxPagado.setSelected(rs.getBoolean(8));
                //String fechaHoyArg = new SimpleDateFormat("dd/MM/YYYY", Locale.FRANCE).format(rs.getDate(6));
                this.jDateChooserEntrada.setDate(rs.getDate(6));
                this.jDateChooserSalida.setDate(rs.getDate(7)); //Fecha de salida - puede fallar por ser nula
                if(this.jDateChooserSalida.getDate() != null)
                    this.jCheckBoxEntregado.setSelected(true);
                this.jTextFieldDescripcion.setText(rs.getString(9));
                this.jTextFieldDueñoCliente.setText("Cliente: " + nombreApellido);
                this.jLabelVh.setText(" ,Camión: " + marcaModeloPat);
            }
        } catch (SQLException ex) {
            JOptionPane.showMessageDialog(null, "Error al obtener datos: " + ex.getMessage());
            this.controlador.cerrarPanelSeleccionado();
        }
    }

    private void cargarTablaPagos(int numero) {
        Connection co = this.controlador.obtenerConexion();
        Object Registro[] = new Object[5];
        Object Registro2[] = new Object[5];
        String consultaCheque, consultaContado;
        //idcheque, fecha_emision, fecha_cobro, idforma_de_pago, monto, numerocheque, cobrado
        consultaCheque = "select cheque.* from forma_de_pago as fdp inner join planilla as p"
                + " on p.idplanilla = fdp.idplanilla inner join cheque on "
                + "cheque.idforma_de_pago = fdp.idforma_de_pago where p.idplanilla = '" + numero + "'";

        consultaContado = "select contado.* from forma_de_pago as fdp inner join planilla as p"
                + " on p.idplanilla = fdp.idplanilla inner join contado on "
                + " contado.idforma_de_pago = fdp.idforma_de_pago where p.idplanilla = '" + numero + "'";

        try {
            Statement st = co.createStatement();
            ResultSet rs = st.executeQuery(consultaCheque);
            while (rs.next()) {
                /*Registro[0] = idFdP;
                Registro[1] = tipo_pago;
                Registro[2] = monto;
                Registro[3] = cobrado;*/
                Registro[0] = rs.getInt(1); // idCheque
                Registro[1] = "Cheque";
                Registro[2] = rs.getLong(5);
                Registro[3] = rs.getBoolean(7); // cobrado. Según orden de la consulta anterior
                this.modeloPagos.addRow(Registro);
            }
            //idforma_de_pago, idcontado, monto
            Statement st2 = co.createStatement();
            ResultSet rs2 = st2.executeQuery(consultaContado);
            while (rs2.next()) {
                Registro2[0] = rs2.getInt(1); //idContado
                Registro2[1] = "Contado";
                Registro2[2] = rs2.getLong(2); //monto - bigint
                Registro2[3] = true;
                this.modeloPagos.addRow(Registro2);
            }

        } catch (SQLException ex) {
            JOptionPane.showMessageDialog(null, "Error al obtener datos: " + ex.getMessage());
        }
        this.jTablePagos.updateUI();
    }

    private void prepararModelosTablas() {
        tablaReparaciones = new DefaultTableModel() {
            @Override
            public boolean isCellEditable(int row, int column) {
                //all cells false
                return false;
            }
        };
        modeloPagos = new DefaultTableModel() {
            @Override
            public boolean isCellEditable(int row, int column) {
                //all cells false
                return false;
            }
        };
        tablaReparaciones.setColumnIdentifiers(getColumnas());
        modeloPagos.setColumnIdentifiers(getColumnasPagos());
    }

    private void jButtonAdRepActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonAdRepActionPerformed
        //Nota: La planilla ya deberia haber sido guardada (Se requiere que se elija el Cliente y el chofer - 
        // - fecha de entrada por defecto)
        int numPlanilla = (Integer.valueOf(this.jLabelNumPlanilla.getText())); //Numero de esta planilla
        JLabel label = new JLabelAriel("Debe guardar la planilla antes de agregar una Reparación");


        if (estaGuardada()) { //Consulto si la planilla ya se guardo, devuelve 'true' si es así
            PanelAdReparaciones p1 = new PanelAdReparaciones(numPlanilla); //El número se usa para poder guardar la reparación
            this.controlador.cambiarDePanel(p1, "Nueva Reparación");
        }
        else
            JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);

// this.controlador.
    }//GEN-LAST:event_jButtonAdRepActionPerformed

    private boolean estaGuardada() { //Automáticamente obtiene el número de la planilla actual
        int numPlanilla = (Integer.valueOf(this.jLabelNumPlanilla.getText())); //Numero de esta planilla
        String consulta = "Select EXISTS (Select idplanilla from planilla where idplanilla = '"+numPlanilla+"')";
        boolean existe = false;
        try {
            Statement st = this.controlador.obtenerConexion().createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while(rs.next()){
                existe = rs.getBoolean(1);
            }
            
        } catch (SQLException ex) {
            //
        }
        //Si la planilla existe en la Base de datos, entonces, se retorna 'true'
        return existe;
    }
    
    public void agregarReparacion(int idRep) {
        //Método que utiliza el idRep para agregar la reparación a su lista

        //Se usa cuando se retorne desde la vista de nueva reparación
    }
    private void jButtonPagoContadoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonPagoContadoActionPerformed
        //Se pulso el botón de agregar Pago. Es entonces un pago nuevo -- Para que dsps el método de agregar lo sepa:
        // --> El jRadioButtonNuevoPago se marcara como seleccionado y el label del id desaparece
        this.jLabelId.setVisible(false);
        this.jLabelIdPago.setVisible(false);
        JLabel label = new JLabelAriel("Debe guardar la planilla antes de agregar un Pago");
        
        if (estaGuardada()) {
            this.montoContado = new RestrictedTextField(this.jTextFieldMontoContado);
            this.montoContado.setOnlyNums(true);

            this.jFrameContado.setVisible(true);  //Abro la Planilla del pago Contado
            this.jDateChooserContado.setDate(new Date());
            this.jTextFieldMontoContado.setText("");       
            this.jRadioButtonNuevoPago.setSelected(true); //Es un nuevo pago
        }
        else
            JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);
    }//GEN-LAST:event_jButtonPagoContadoActionPerformed

    private void jButtonPagoChequeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonPagoChequeActionPerformed
        this.jCheckBoxChequeNuevo.setSelected(true);
        this.jCheckBoxChequeNuevo.setEnabled(false);
        this.jLabelIdCheque.setVisible(false); //No se muestra el id porque es un cheque nuevo
        JLabel label = new JLabelAriel("Debe guardar la planilla antes de agregar un Pago");
        //Hay que preguntar si es para modificar o nueva y dividir debajo un camino a cada método
        if (estaGuardada()) { //Pregunta si la planilla está guardada -- Sin sentido, sino no hubiera llegado hasta acá
            this.montoCheque = new RestrictedTextField(this.jTextFieldMontoCheque);
            this.jTextFieldMontoCheque.setText("0"); //Posiblemente tenga conflicto con el de arriba, aunque recién abajo Restrinjo
            this.montoCheque.setOnlyNums(true);
            this.jCheckBoxChCobrado.setSelected(false);
            this.jFrameCheque.setVisible(true);
            this.jDateChooserChCobro.setDate(new Date());
            // this.jDateChooserChEmision.setDate(new Date());  --Este no porque puede ser nulo
        }
        else  //Hacer lo mismo para el agregado de pagos al contado o cuenta corriente
            JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);
    }//GEN-LAST:event_jButtonPagoChequeActionPerformed

    private void jButtonCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonCancelarActionPerformed
        this.jFrameContado.dispose();
    }//GEN-LAST:event_jButtonCancelarActionPerformed

    private void jButtonCancelarChequeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonCancelarChequeActionPerformed
        this.jFrameCheque.dispose();
    }//GEN-LAST:event_jButtonCancelarChequeActionPerformed

    private void jButtonAgregarChequeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonAgregarChequeActionPerformed
        //Método agregar cheque --- La fecha de emisión puede ser nula --Deberá contemplar si es un cheque siendo modificado
        if(!this.jCheckBoxChequeNuevo.isSelected()){ //Si no está seleccionado --> No es un cheque nuevo
            actualizarCheque();
        }
        else{
            grabarNuevoCheque();
        }
        //----------
    }//GEN-LAST:event_jButtonAgregarChequeActionPerformed

    private void actualizarCheque(){
        //Actualizo el cheque con los datos de la vista y el id del cheque
        int idCheque = Integer.valueOf(this.jLabelIdCheque.getText());
        int numPlanilla = Integer.valueOf((this.jLabelNumPlanilla.getText()));
        Date chequeCobro = this.jDateChooserChCobro.getDate();
        Date chequeEmision = this.jDateChooserChEmision.getDate();
        long monto = Integer.valueOf(this.jTextFieldMontoCheque.getText());
        boolean cobrado = this.jCheckBoxChCobrado.isSelected();
        String numeroCheque = this.jTextFieldNCheque.getText();
        if (chequeCobro != null && monto != 0 && numeroCheque != null) {
            actualizarChequeBdB(idCheque, chequeCobro, numeroCheque, monto, chequeEmision, cobrado);
            this.jFrameCheque.dispose();
            DefaultTableModel dtm = (DefaultTableModel) this.jTablePagos.getModel();
            dtm.setRowCount(0);  //Magicamente funciona y sirve para eliminar las filas de la tabla  
            this.cargarTablaPagos(numPlanilla);
        } else {
            JLabel label = new JLabelAriel("Faltan Datos");
            JOptionPane.showMessageDialog(null, label, "ATENCIÓN!!", JOptionPane.WARNING_MESSAGE);      
        }
    }

    private void grabarNuevoCheque(){

        int idFdP = 0; //id forma de pago -- AHORA SE USA EL ID DEL CHEQUE
        int numPlanilla = Integer.valueOf(this.jLabelNumPlanilla.getText());
        Date chequeCobro = this.jDateChooserChCobro.getDate();
        Date chequeEmisión = this.jDateChooserChEmision.getDate();
        long monto = Integer.valueOf(this.jTextFieldMontoCheque.getText());
        boolean cobrado = this.jCheckBoxChCobrado.isSelected();
        
        String numeroCheque = this.jTextFieldNCheque.getText();
        if (chequeCobro != null && monto != 0 && numeroCheque != null) {
            idFdP = grabarCheque(chequeEmisión, monto, chequeCobro, numeroCheque, cobrado); //true si grabó bien
            
            if (idFdP != 0) {
               // agregarPagoATabla(idFdP, "cheque", monto, cobrado); No se usa más
                DefaultTableModel dtm = (DefaultTableModel) this.jTablePagos.getModel();
                dtm.setRowCount(0);  //Magicamente anduvo y sirve para eliminar las filas de la tabla
                this.cargarTablaPagos(numPlanilla);
                JLabel label = new JLabelAriel("Cheque Agregado");
                JOptionPane.showMessageDialog(this.jFrameCheque, label, "ATENCIÓN!", JOptionPane.PLAIN_MESSAGE);
                this.jFrameCheque.dispose();
            }
        }else{
            JLabel label = new JLabelAriel("Faltan Datos, la fecha de cobro del cheque es obligatoria");
            JOptionPane.showMessageDialog(null, label, "ATENCIÓN!!", JOptionPane.WARNING_MESSAGE); 
        }
    }
    
    private void jButtonFVhActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonFVhActionPerformed
        //Filtro para los vehículos. A travéz de una patente filtra los datos del JComboBoxCamiones
        String marca, modelo, patente;
        try {
            //Acá hay que filtrar los vehículos por la patente escrita en jTextFielFPatente
            this.quitarActionListenersJComboBox();
            String patenteFiltro = this.jTextFieldFPatente.getText();
            patenteFiltro = patenteFiltro.toLowerCase();

            PreparedStatement ps = this.controlador.obtenerConexion().prepareStatement("SELECT v.idvehiculo, v.marca, v.modelo, v.patente "
                    + "FROM vehiculo AS v WHERE lower(v.patente) LIKE ? ");
            ps.setString(1, "%"+patenteFiltro+"%");
            // En este método el ActionItemListener debería haber sido quitado
            this.jComboBoxVh.removeAllItems();
            ComboItem cmItem = new ComboItem("0", "<<Seleccione un Camión>>");
            this.jComboBoxVh.addItem(cmItem);
            ComboItem cmItem2 = new ComboItem("0", "--Ver Todos--");
            this.jComboBoxVh.addItem(cmItem2);
            ResultSet rs = ps.executeQuery();
            while (rs.next()) {
                String idVh = String.valueOf(rs.getInt(1));
                marca = rs.getString(2);
                modelo = rs.getString(3);
                patente = rs.getString(4);
                String marcaModelo = marca + " " + modelo;
                ComboItem comboItem = new ComboItem(idVh, marcaModelo + " " + patente); //(clave, valor)
                this.jComboBoxVh.addItem(comboItem);
                this.jComboBoxVh.updateUI();
                //Modificado en "code" --> "type" en parte de Diseño de Netbeans
                //Para obtener el valor por patente:
                /*Object item = comboBox.getSelectedItem();
                String value = ((ComboItem)item).getValue(); ó .getKey() según se prefiera*/
            }
       /*     if (!patenteFiltro.equals("")) { //Si el filtro de la patente no está vacío
                cargarVhBdD(ps, patenteFiltro); //
            } else {
                JOptionPane.showMessageDialog(null, "Debe escribir una patente");
            } */
            this.agregarListenersJComboBox();
        } catch (SQLException ex) {
            JLabel label = new JLabelAriel("Error en el Filtrado: "+ex.getMessage());
            JOptionPane.showMessageDialog(null, label, "ATENCIÓN!!", JOptionPane.WARNING_MESSAGE);
            System.out.println("Error:"+ex.getMessage());
        }
    }//GEN-LAST:event_jButtonFVhActionPerformed

    private void jButtonGuardarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonGuardarActionPerformed
        //El dato de Camión es necesario y sirve para completar el campo de cliente (obligatorio)
        // El dato fecha de salida y descripción pueden ser nulos
        //Fecha_entrada, Entregado, Facturado, Planilla Paga nunca están vacíos
        JLabel label2 = new JLabelAriel(" La descripción no puede estar vacía ");
        ComboItem vh = (ComboItem) this.jComboBoxVh.getSelectedItem(); //El camión
        ComboItem ch = (ComboItem) this.jComboBoxPersona.getSelectedItem(); //El chofer
        String descripcion = this.jTextFieldDescripcion.getText();
        {
            Object fSalida = this.jDateChooserSalida.getDate();
            if (estaGuardada()) // Retorna true si está guardada; Automáticamente obtiene el numero de Planilla
            { //Quizás se pueda agregar al más acá
                if(!descripcion.equals(""))
                    actualizarPlanilla(fSalida == null); //Condicional: 'true' o 'false' - 'true' en caso de que la fecha de salida sea nula
                else
                    JOptionPane.showMessageDialog(null, label2, "ERROR", JOptionPane.WARNING_MESSAGE);
                //Se podría agregar un JLabel que diga que ya se actualizo
            } else if(!(vh.getKey().equals("0") || ch.getKey().equals("0") || descripcion.equals(""))){
                guardarPlanilla();
                //Se podría agregar un JLabel que diga que ya se guardo
            }
            else{
                JLabel label = new JLabelAriel(" Datos incompletos - Vehículo, chofer y descripción obligatorios ");
                JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);        
        }
    }


    }//GEN-LAST:event_jButtonGuardarActionPerformed

    private void guardarPlanilla() { //Datos: idplanilla, fecha in, fecha out, pagado, desc, idCliente, idPersona, idVh, facturado
        Object fSalida = this.jDateChooserSalida.getDate();
        Object fEntrada = this.jDateChooserEntrada.getDate();
        if (fEntrada != null) {   //Fijarse si falta algo
            if (fSalida == null) {
                guardarEnBdD(false);
            } else {
                guardarEnBdD(true); //La fecha de salida esta seteada
            }
        } else {
            //No se puede guardar porque los campos "tal y tal" están vacíos (ponele)
        }

    }

    private void guardarEnBdD(Boolean fSalidaNula) {
        ComboItem chofer = (ComboItem) this.jComboBoxPersona.getSelectedItem(); //chofer.getKey() = id de la persona
        ComboItem vh = (ComboItem) this.jComboBoxVh.getSelectedItem(); // vh.getKey() = id del vehículo
        Connection co = this.controlador.obtenerConexion();
        try {
            co.setAutoCommit(false); //Para realizar la transacción
            PreparedStatement ps = co.prepareStatement("INSERT INTO planilla VALUES(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");

            ps.setInt(1, Integer.valueOf(this.jLabelNumPlanilla.getText()));
            ps.setDate(2, new java.sql.Date(this.jDateChooserEntrada.getDate().getTime()));
            if (this.jCheckBoxEntregado.isSelected()) { //Si está facturado cargo la fecha
                if (!fSalidaNula) { //Si no es nula guarda la fecha
                    ps.setDate(3, new java.sql.Date(this.jDateChooserSalida.getDate().getTime())); //Problemas cuando es null
                } else {
                    ps.setDate(3, null);
                }
            } else {
                ps.setDate(3, null);
            }
            ps.setBoolean(4, this.jCheckBoxPagado.isSelected()); //pagado
            ps.setString(5, this.jTextFieldDescripcion.getText());
            ps.setInt(6, this.idCliente);
            ps.setInt(7, Integer.valueOf(chofer.getKey())); //idpersona - para chofer
            ps.setInt(8, Integer.valueOf(vh.getKey()));
            ps.setBoolean(9, this.jCheckBoxFacturado.isSelected()); //facturado
            ps.setBoolean(10, this.jCheckBoxEntregado.isSelected()); //Entregado
            int executeUpdate = ps.executeUpdate();
            co.commit(); //Ahora si se acepta que anduvo bien
            JOptionPane.showMessageDialog(null, "Guardado con éxito");
            this.jButtonGuardar.setText("Actualizar");
        } catch (SQLException ex) {
            try {
                co.rollback();
            } catch (SQLException ex1) {
                JOptionPane.showMessageDialog(null, "Error: " + ex1.getMessage());
            }
            JOptionPane.showMessageDialog(null, "Error: " + ex.getMessage());
        }
    }

    private void actualizarPlanilla(Boolean fSalidaNula) { //Si la fecha de salida es nula
    //    ComboItem chofer = (ComboItem) this.jComboBoxPersona.getSelectedItem(); //chofer.getKey() = id de la persona
    //    ComboItem vh = (ComboItem) this.jComboBoxVh.getSelectedItem(); // vh.getKey() = id del vehículo
        Connection co = this.controlador.obtenerConexion();
        int idPlanilla;
        idPlanilla = Integer.valueOf(this.jLabelNumPlanilla.getText());
        try {
            co.setAutoCommit(false); //Para realizar la transacción
            PreparedStatement ps = co.prepareStatement("UPDATE planilla SET fecha_de_salida = ?, "
                    + "pagado = ?, descripcion = ?, facturado = ?, entregado = ? WHERE idplanilla = '"+idPlanilla+"' ");

          //  ps.setInt(1, Integer.valueOf(this.jLabelNumPlanilla.getText())); //Los comentados no se cargar en la actualización
          //  ps.setDate(2, new java.sql.Date(this.jDateChooserEntrada.getDate().getTime()));
          if(this.jCheckBoxEntregado.isSelected()){ //Si está facturado cargo la fecha  
            if (!fSalidaNula) 
                  ps.setDate(1, new java.sql.Date(this.jDateChooserSalida.getDate().getTime())); //Problemas cuando es null-resuelto
            //else
                //No se setea la fecha como nula porque aparentemente genera error en la actualización
            }
          else
              ps.setDate(1, null);
              
            ps.setBoolean(2, this.jCheckBoxPagado.isSelected()); //pagado
            ps.setString(3, this.jTextFieldDescripcion.getText());
          //  ps.setInt(4, this.idCliente); No se carga en la actualización
          //  ps.setInt(4, Integer.valueOf(chofer.getKey())); //idpersona (chofer) - Permite editar aunque si no gusta se podría quitar
           // ps.setInt(8, Integer.valueOf(vh.getKey())); // No se carga en la actualización
            ps.setBoolean(4, this.jCheckBoxFacturado.isSelected()); //facturado
            ps.setBoolean(5, this.jCheckBoxEntregado.isSelected()); //Entregado
            int executeUpdate = ps.executeUpdate();
            co.commit(); //Ahora si se acepta que anduvo bien
            JOptionPane.showMessageDialog(null, "Actualizado con éxito");
        } catch (SQLException ex) {
            try {
                co.rollback();
            } catch (SQLException ex1) {
                JOptionPane.showMessageDialog(null, "Error: " + ex1.getMessage());
            }
            JOptionPane.showMessageDialog(null, "Error: " + ex.getMessage());
        }
    }

    private void jButtonFPerActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonFPerActionPerformed
        String filtroPersona = this.jTextFieldFPersona.getText();
        this.quitarActionListenersJComboBox();
        if (!filtroPersona.equals("")) {
            filtroPersona = filtroPersona.toLowerCase(); //Para que puedan compararse en la consulta como minúsculas
        }
        String consulta = "SELECT p.nombre, p.apellido, c.apodo, p.idpersona FROM persona AS p INNER JOIN chofer AS c "
                + "ON p.idpersona = c.idpersona WHERE lower(p.nombre) LIKE '%"+filtroPersona+"%' "
                + "or lower(c.apodo) LIKE '%"+filtroPersona+"%' ";
        if (!filtroPersona.equals("")) {//Si el filtro de Persona no está vacío
            this.cargarPersonasBdD(consulta);
        } else {
            JOptionPane.showMessageDialog(null, "Debe ingresar un Nombre o un Apodo para poder filtrar ");
        }

        this.agregarListenersJComboBox();
    }//GEN-LAST:event_jButtonFPerActionPerformed

    private void jFrameDeudaPlanillaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jFrameDeudaPlanillaActionPerformed
        //¿La cuenta corriente tendría que empezar desde el día que el camión de esta planilla esté entregado? - Sí
        //Quizás esta vista tendría que poner un jTextField con el total del importe y preguntar si ese total está bien
        JLabel label = new JLabelAriel("Debe guardar la planilla antes de agregar un Pago");
        JLabel label2;
        
        long montoRestante = 0;
        if (!true/*this.jCheckBoxEntregado.isSelected()*/) { //si el vh no está entregado -- Modificado para que no joda
            label2 = new JLabelAriel("El Vehículo debe ser entregado antes de calcular Deudas");
            JOptionPane.showMessageDialog(null, label2, "Error", JOptionPane.INFORMATION_MESSAGE);
        } else {
            if (estaGuardada()) {
                this.jFrameEstadoPagos.setVisible(true);
                this.jTextFieldImporteTotal.setText(montoPorReparaciones()+"");
                this.jTextFieldMontoPagado.setText(montoPagos(Integer.valueOf(this.jLabelNumPlanilla.getText()))+"");
                int numPlanilla = Integer.valueOf(this.jLabelNumPlanilla.getText());
                montoRestante = montoPorReparaciones() - montoPagos(numPlanilla);
                this.jTextFieldCC.setText(montoRestante+"");
                this.jTextFieldACobrar.setText(montoACobrarCheques(numPlanilla)+"");
            } else {
                JOptionPane.showMessageDialog(null, label, "Error", JOptionPane.WARNING_MESSAGE);
            }
        } //Termina el else que permite abrir la Vista


    }//GEN-LAST:event_jFrameDeudaPlanillaActionPerformed

    private long montoPorReparaciones(){
        //Método que devuelve la suma de los importes de las reparaciones que tenga la planilla actual
        long monto = 0;
        String consulta = "SELECT SUM(importe) FROM reparacion WHERE idplanilla = "
                + "'"+Integer.valueOf(this.jLabelNumPlanilla.getText())+"' ";
        
        Connection co = this.controlador.obtenerConexion();
        try {
            Statement st = co.createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while(rs.next()){ //El importe es uno solo pero así evitamos intentar capturar un valor cuando el importe es null
                monto += rs.getLong(1); //El monto suma el importe de todas las reparaciones enmarcadas por esta planilla
            }
        } catch (SQLException ex) {

        }
        return monto;
    }
    
    private Long montoPagos(int idPlanilla){
        //Método que calcula cuanto dinero se recibió - Los cheques no cobrados se suman como pagos igualmente
       // long montoRep = this.montoPorReparaciones();
        long monto = 0; 
        //Esta consulta Retorna dos valores para los montos de pago de cheques y contado 
        String consulta = "Select sum(ch.monto) from cheque as ch inner join forma_de_pago as fdp on fdp.idforma_de_pago = ch.idforma_de_pago "
                + "inner join planilla as p on p.idplanilla = fdp.idplanilla where p.idplanilla= '"+idPlanilla+"' "
                + "UNION"
                + " select sum(c.monto) from contado as c inner join forma_de_pago as fdp on fdp.idforma_de_pago = c.idforma_de_pago "
                + "inner join planilla as p on p.idplanilla = fdp.idplanilla where p.idplanilla = '"+idPlanilla+"'";
        try {
            Statement st = this.controlador.obtenerConexion().createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while(rs.next()){
                monto += rs.getLong(1); //Hay que probar si anda - Entiendo que primero toma el monto de cheque y en el siguiente el de contado
            }
            
        } catch (SQLException ex) {
            JLabel label = new JLabelAriel(" Error al cargar pagos: " + ex.getMessage());
            JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);
        }
        return monto;
    }

    private long montoACobrarCheques(int idPlanilla){
        // Retorna el monto que falta por cobrar de los cheques obtenidos.
        long montoSinAcreditarse = 0;
        String consulta = "select sum(monto) from cheque as c inner join forma_de_pago as fdp on c.idforma_de_pago = fdp.idforma_de_pago "
                + "inner join planilla as p on p.idplanilla = fdp.idplanilla where p.idplanilla = '"+idPlanilla+"' and c.cobrado = false;";
        try {
            Statement st = this.controlador.obtenerConexion().createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while(rs.next()){
                montoSinAcreditarse = rs.getLong(1);
            }
            
        } catch (SQLException ex) {
            //~~~~
        }
        
        return montoSinAcreditarse;
    }
    
    private void jButtonVerPagoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonVerPagoActionPerformed
        //Supongo que tengo que armar la vista de "Ver pagos" o "Editar Pagos" y pasarle el id de este pago - Nó!
        //La información del pago seleccionado puede mostrarse en sus respectivas vistas
        int filaSelect = this.jTablePagos.getSelectedRow();
        if(filaSelect != -1){ //Seleccione una fila
            String tipoPago = (String) this.jTablePagos.getValueAt(filaSelect, 1); //Para saber si es Cheque o Contado
            int idPago = (int) this.jTablePagos.getValueAt(filaSelect, 0);
            if(tipoPago.toLowerCase().equals("cheque"))
                modificarCheque(idPago);//Abro la vista de Cheque - Poner método acá
            else
                modificarContado(idPago);//Abro vista contado
        }
        else{
            JLabel label = new JLabelAriel("Debe seleccionar una fila de la Tabla de Pagos ");
            JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);
        }
            
    }//GEN-LAST:event_jButtonVerPagoActionPerformed

    private void jButtonAceptarDeudasActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonAceptarDeudasActionPerformed
        this.jFrameEstadoPagos.dispose();
    }//GEN-LAST:event_jButtonAceptarDeudasActionPerformed

    private void jButtonQuitarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonQuitarActionPerformed
        //Tengo que quitar la reparación seleccionada. Nose como lo hare pero quizás se pueda con la ayuda del while de una consulta
        int filaSeleccionada = this.jTableReparaciones.getSelectedRow();
        JLabel label = new JLabelAriel(" No hay fila seleccionada ");
        if (filaSeleccionada != -1) {
            borrarRepDeTabla(filaSeleccionada);
        } else {
            JOptionPane.showMessageDialog(null, label, "ATENCIÓN", JOptionPane.WARNING_MESSAGE);
        }
        this.onFocus(); //Método para actualizar toda la info, incluída las reparaciones

    }//GEN-LAST:event_jButtonQuitarActionPerformed

    private void jButtonAgregarContadoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonAgregarContadoActionPerformed
        //Para agregar este pago necesito generar un nuevo objeto "forma_de_pago" en la Base de Datos
        //Método agregar cheque --- La fecha de emisión puede ser nula
        //--Dsps habría que preguntar acá si es para Actualizar o Grabar Nuevo -- NOSE COMO
        int numPlanilla = Integer.valueOf(this.jLabelNumPlanilla.getText());
        if (this.jRadioButtonNuevoPago.isSelected()) //Es un Pago Contado Nuevo
            agregarPagoContado();
        else
            actualizarPagoContado(); //No es nuevo así que hay que actualizar 
        this.jFrameContado.dispose();
        this.cargarTablaPagos(numPlanilla);
    }//GEN-LAST:event_jButtonAgregarContadoActionPerformed

    private void agregarPagoContado(){
        int idFdP = 0; //id forma de pago
     //   int numPlanilla = Integer.valueOf(this.jLabelNumPlanilla.getText());
        long monto = 0;
        this.jRadioButtonNuevoPago.setEnabled(false);
        Date diaCobro = this.jDateChooserContado.getDate();
        if (!this.jTextFieldMontoContado.getText().equals("")){ //Si el monto no está vacío
            monto = Integer.valueOf(this.jTextFieldMontoContado.getText());
        }
        if (diaCobro != null && monto != 0) {
            idFdP = grabarNuevoPagoContado(monto, diaCobro); //valor distinto de 0 si grabó bien
            if (idFdP != 0) {
                DefaultTableModel dtm = (DefaultTableModel) this.jTablePagos.getModel();
                dtm.setRowCount(0);  //Magicamente anduvo y sirve para eliminar las filas de la tabla            
                JLabel label2 = new JLabelAriel("Pago Contado Agregado");
                JOptionPane.showMessageDialog(this.jFrameContado, label2, "MENSAJE", JOptionPane.INFORMATION_MESSAGE);
            }
        } else {
            JLabel label3 = new JLabelAriel("Faltan Datos");
            JOptionPane.showMessageDialog(null, label3, "FALTAN DATOS", JOptionPane.WARNING_MESSAGE);
        }      
    }
    

    
    private void jButtonBorrarPagoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonBorrarPagoActionPerformed
        //Borrar el Pago seleccionado - Recordar que el id de la tabla es de cada pago
        int filaSelect = this.jTablePagos.getSelectedRow();
        int numPlanilla = Integer.valueOf(this.jLabelNumPlanilla.getText());
        if(filaSelect != -1){ //Hay fila seleccionada --> Hay que borrar el pago seleccionado viendo si es cheque o contado
            String tipoPago = (String) this.jTablePagos.getValueAt(filaSelect, 1); //Para saber si es Cheque o Contado
            if(tipoPago.toLowerCase().equals("cheque"))
                borrarCheque(""+this.jTablePagos.getValueAt(filaSelect, 0)); //Paso el id del cheque
            else
                borrarContado("" + this.jTablePagos.getValueAt(filaSelect, 0)); //Paso el id del contado
            DefaultTableModel dtm = (DefaultTableModel) this.jTablePagos.getModel();
            dtm.setRowCount(0);  //Magicamente anduvo y sirve para eliminar las filas de la tabla 
            this.cargarTablaPagos(numPlanilla); //Actualizo la tabla de pagos
        } else {
            JLabel label3 = new JLabelAriel("No hay fila Seleccionada");
            JOptionPane.showMessageDialog(null, label3, "FALTAN DATOS", JOptionPane.WARNING_MESSAGE);
        }
    }//GEN-LAST:event_jButtonBorrarPagoActionPerformed

    private void jButtonCancelActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButtonCancelActionPerformed
        // Tendría que cerrar la planilla borrando si estoy agregando una persona. Si estoy modificando simplemente 
        //llamar al controlador con "cerrarPanelSeleccionado()"
        
        
    }//GEN-LAST:event_jButtonCancelActionPerformed

    /**/
    private void borrarCheque(String idcheque){
        int idCh = Integer.valueOf(idcheque);
        try {
            PreparedStatement ps = this.controlador.obtenerConexion().prepareStatement("DELETE FROM cheque where idcheque = ?");
            ps.setInt(1, idCh);
            ps.executeUpdate();
            JLabel label3 = new JLabelAriel("Cheque eliminado");
            JOptionPane.showMessageDialog(null, label3, "ATENCIÓN!", JOptionPane.PLAIN_MESSAGE);
        } catch (SQLException ex) {
            JLabel label3 = new JLabelAriel("Error: "+ex.getMessage());
            JOptionPane.showMessageDialog(null, label3, "Borrado fallido", JOptionPane.WARNING_MESSAGE);
        }
    }
    
    private void borrarContado(String idcontado){
        int idCon = Integer.valueOf(idcontado);
        try {
            PreparedStatement ps = this.controlador.obtenerConexion().prepareStatement("DELETE FROM contado where idcontado = ?");
            ps.setInt(1, idCon);
            ps.executeUpdate();
            JLabel label3 = new JLabelAriel("Pago Contado eliminado");
            JOptionPane.showMessageDialog(null, label3, "ATENCIÓN!", JOptionPane.PLAIN_MESSAGE);
        } catch (SQLException ex) {
            JLabel label3 = new JLabelAriel("Error: "+ex.getMessage());
            JOptionPane.showMessageDialog(null, label3, "Borrado fallido", JOptionPane.WARNING_MESSAGE);
        } 
    }
    
    /*
    private int grabarContado(long monto, Date diaCobro) {
        //Devuelve true si fue agregado o actualizado correctamente
        if (true) //Acá habrá que preguntar si és nuevo o para actualizar
        {
            return grabarNuevoPagoContado(monto, diaCobro);
        } else {
            return actualizarPagoContado(monto, diaCobro);// Acá debería poner UPDATE en vez de INSERT
        }
    } */

    private int grabarNuevoPagoContado(long monto, Date diaCobro) {
        // En este método hay que grabar primero la forma de pago y dsps tomar el id generado y grabar el pago contado
        // Todo esto en forma de transacción para que no queden datos afori
        int idFdP = 0; //paqe no joda -dsps borrar
        int numPlanilla = Integer.valueOf(this.jLabelNumPlanilla.getText());
        Connection co = this.controlador.obtenerConexion();
        try {
            co.setAutoCommit(false);
            //Codigo para grabar fDP
            PreparedStatement ps = co.prepareStatement("INSERT INTO forma_de_pago VALUES(default, ?, ?)", 
                    Statement.RETURN_GENERATED_KEYS);
            ps.setObject(1, "contado", Types.OTHER); //Es un ENUM
            ps.setInt(2, numPlanilla);
            ps.executeUpdate();
            try (ResultSet generatedKeys = ps.getGeneratedKeys()) {
                if (generatedKeys.next()) {
                    idFdP = generatedKeys.getInt(1);
                }
                PreparedStatement ps2 = co.prepareStatement("INSERT INTO contado "
                        + "VALUES(default, ?, ?, ?)");
                ps2.setLong(1, monto);
                ps2.setInt(2, idFdP);
                ps2.setDate(3, new java.sql.Date(diaCobro.getTime()));
                ps2.executeUpdate();
                co.commit();
            }
        } catch (SQLException ex) {
            System.out.println("Error: " + ex.getMessage());
            try {
                co.rollback();
            } catch (SQLException ex1) {
                System.out.println("Error: " + ex1.getMessage());
            }
        }
        return idFdP;
    }
    
    private void actualizarPagoContado(){
        // Actualizo un pago contado
        int idPago = Integer.valueOf(this.jLabelIdPago.getText());
   //   int numPlanilla = Integer.valueOf(this.jLabelNumPlanilla.getText());
        long monto = Integer.valueOf(this.jTextFieldMontoContado.getText());
        this.jRadioButtonNuevoPago.setEnabled(false);
        Date diaCobro = this.jDateChooserContado.getDate();
        Connection co = this.controlador.obtenerConexion();
        try {
            co.setAutoCommit(false);
            PreparedStatement ps = co.prepareStatement("UPDATE contado SET monto = '"+monto+"', "
            + "fecha = '"+diaCobro+"' WHERE idcontado = '"+idPago+"' "); //La fecha no creo que ande
            
            DefaultTableModel dtm = (DefaultTableModel) this.jTablePagos.getModel();
            dtm.setRowCount(0);  //Magicamente anduvo y sirve para eliminar las filas de la tabla 
            ps.executeUpdate();
            co.commit();
        } catch (SQLException ex) {
            System.out.println("Error: " + ex.getMessage());
            try {
                co.rollback();
            } catch (SQLException ex1) {
                System.out.println("Error: " + ex1.getMessage());
            }
        }       
    }

    private void borrarRepDeTabla(int filaSeleccionada){
        //El numero de fila seleccionada haría coincidir la reparación que se busca teniendo en cuenta el orden en que salen
        String consulta = "SELECT idreparacion FROM reparacion";
        int idRepSeleccionada = 0;
        int i = 0;
        try {
            Statement st = this.controlador.obtenerConexion().createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while(rs.next()){
                idRepSeleccionada = rs.getInt(1);
                if(idRepSeleccionada == filaSeleccionada)
                    break;
                //else: sigue hasta que la fila seleccionada indique que id de reparación tenemos
            }
            borrarReparacion(idRepSeleccionada);
            
        } catch (SQLException ex) {
            //
        }
    }
    
    private void borrarReparacion(int idRep){
        if(idRep != 0){
            try {
                PreparedStatement ps = this.controlador.obtenerConexion().prepareStatement(""
                        + "DELETE FROM reparacion WHERE idreparacion = '"+idRep+"'");
                int executeUpdate = ps.executeUpdate();
                JLabel label = new JLabelAriel("Reparación Borrada");
                JOptionPane.showMessageDialog(null, label, "INFO", JOptionPane.INFORMATION_MESSAGE);                
            } catch (SQLException ex) {
                JLabel label = new JLabelAriel("Error al intentar borrar Reparación"+ex.getMessage());
                JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);
            }
        }
    }
    
    private void jComboBoxPersonaItemStateChanged(ItemEvent evt) {
        //---
        this.quitarActionListenersJComboBox();
        ComboItem perSeleccionada = (ComboItem) this.jComboBoxPersona.getSelectedItem();
        if ("0".equals(perSeleccionada.getKey())) //Seleccione --Ver Todos--
        {
            this.cargarPersonas("0");
            this.jComboBoxPersona.setSelectedIndex(1); //Para solucionar una búsqueda que el ComboBox hace de más
        } else if("-1".equals(perSeleccionada.getKey()))
            this.cargarPersonas("-1");//el -1 servirá para cargar sólo los choferes
        else
            ; //Nada para hacer - Se seleccionó un Chofer o una persona
        this.agregarListenersJComboBox();
    }

    private void jComboBoxVhItemStateChanged(java.awt.event.ItemEvent evt) {
        //Método que se ejecuta cuando hago selecciono un item en el ComboBox de Vehículos
        quitarActionListenersJComboBox();
        this.jTextFieldDueñoCliente.setText(" ");
        Object item = this.jComboBoxVh.getSelectedItem();
        String patente = ((ComboItem) item).getKey(); //En realidad no trae la patente sino el idVh
        if (!patente.equals("0")) {
            this.cargarCliente(patente); //Hay idVh --> cargo el Cliente de esa patente
        } else {
            this.cargarCamiones(0); //Porque aprete "Ver Todos"
        }
        this.agregarListenersJComboBox();
    }
    /* ITEM LISTENNER DE ComboBox de Cliente
    private void jComboBoxCliItemStateChanged(java.awt.event.ItemEvent evt){
        quitarActionListenersJComboBox();
        //Método que se ejecuta cuando hago selecciono un item en el ComboBox de Clientes
        Object item = this.jComboBoxCli.getSelectedItem();
        String idCli = ((ComboItem) item).getKey();
        if(!idCli.equals("0"))
            this.cargarCamiones(Integer.valueOf(idCli));
        else 
            this.cargarCamiones(0);
        this.agregarListenersJComboBox();
    }
     */
 /* //Ver si seleccione un cliente --> Cargar los camiones de tal cliente
        Object item = comboBox.getSelectedItem();
        String value = ((ComboItem)item).getValue(); ó .getKey() según se prefiera 
        Object item = this.jComboBoxCli.getSelectedItem(); 
        String idCli = ((ComboItem)item).getKey();
        if(!idCli.equals("0"))
            this.cargarCamiones(Integer.valueOf(idCli));  //Cargo los camiones según el idCLiente
        else //Hay que restaurar la casilla de los camiones
            this.cargarCamiones(0); //El 0 indica que hay que cargar todos los camiones */

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.ButtonGroup buttonGroupAModif;
    private javax.swing.ButtonGroup buttonGroupNPago;
    private javax.swing.JButton jButtonAceptarDeudas;
    private javax.swing.JButton jButtonAdRep;
    private javax.swing.JButton jButtonAgregarCheque;
    private javax.swing.JButton jButtonAgregarContado;
    private javax.swing.JButton jButtonBorrarPago;
    private javax.swing.JButton jButtonCancel;
    private javax.swing.JButton jButtonCancelar;
    private javax.swing.JButton jButtonCancelarCheque;
    private javax.swing.JButton jButtonFPer;
    private javax.swing.JButton jButtonFVh;
    private javax.swing.JButton jButtonGuardar;
    private javax.swing.JButton jButtonPagoCheque;
    private javax.swing.JButton jButtonPagoContado;
    private javax.swing.JButton jButtonQuitar;
    private javax.swing.JButton jButtonVerPago;
    private javax.swing.JCheckBox jCheckBoxChCobrado;
    private javax.swing.JCheckBox jCheckBoxChequeNuevo;
    private javax.swing.JCheckBox jCheckBoxEntregado;
    private javax.swing.JCheckBox jCheckBoxFacturado;
    private javax.swing.JCheckBox jCheckBoxPagado;
    private javax.swing.JComboBox<ComboItem> jComboBoxPersona;
    private javax.swing.JComboBox<ComboItem> jComboBoxVh;
    private com.toedter.calendar.JDateChooser jDateChooserChCobro;
    private com.toedter.calendar.JDateChooser jDateChooserChEmision;
    private com.toedter.calendar.JDateChooser jDateChooserContado;
    private com.toedter.calendar.JDateChooser jDateChooserEntrada;
    private com.toedter.calendar.JDateChooser jDateChooserFEntrega;
    private com.toedter.calendar.JDateChooser jDateChooserSalida;
    private javax.swing.JFrame jFrameCheque;
    private javax.swing.JFrame jFrameContado;
    private javax.swing.JButton jFrameDeudaPlanilla;
    private javax.swing.JFrame jFrameEstadoPagos;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel20;
    private javax.swing.JLabel jLabel21;
    private javax.swing.JLabel jLabel22;
    private javax.swing.JLabel jLabel23;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JLabel jLabelChofer;
    private javax.swing.JLabel jLabelCliente;
    private javax.swing.JLabel jLabelFPatente;
    private javax.swing.JLabel jLabelFechaPl;
    private javax.swing.JLabel jLabelId;
    private javax.swing.JLabel jLabelIdCheque;
    private javax.swing.JLabel jLabelIdPago;
    private javax.swing.JLabel jLabelNombreApodo;
    private javax.swing.JLabel jLabelNumPlanilla;
    private javax.swing.JLabel jLabelVh;
    private javax.swing.JRadioButton jRadioButtonNuevoPago;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JTable jTablePagos;
    private javax.swing.JTable jTableReparaciones;
    private javax.swing.JTextField jTextFieldACobrar;
    private javax.swing.JTextField jTextFieldCC;
    private javax.swing.JTextField jTextFieldDescripcion;
    private javax.swing.JTextField jTextFieldDueñoCliente;
    private javax.swing.JTextField jTextFieldFPatente;
    private javax.swing.JTextField jTextFieldFPersona;
    private javax.swing.JTextField jTextFieldImporteTotal;
    private javax.swing.JTextField jTextFieldMontoCheque;
    private javax.swing.JTextField jTextFieldMontoContado;
    private javax.swing.JTextField jTextFieldMontoPagado;
    private javax.swing.JTextField jTextFieldNCheque;
    // End of variables declaration//GEN-END:variables

    private int grabarCheque(Date chequeEmisión, long monto, Date chequeCobro, String nCheque, boolean cobrado) {
        int idFdP = 0; // idforma_de_pago - La inicializo porque el IDE jode
        Connection co = this.controlador.obtenerConexion();
        try {  //  ... tipo_pago = {cheque, contado, CC}
            co.setAutoCommit(false); //Para poder hacer una transaccion
            PreparedStatement st = co.prepareStatement("INSERT INTO forma_de_pago values (default, ?, ?)",
                    Statement.RETURN_GENERATED_KEYS);
            //Using setObject(1,'Divorced',Types.OTHER)
            st.setObject(1, "cheque", Types.OTHER);
            st.setInt(2, Integer.valueOf(this.jLabelNumPlanilla.getText()));
            st.executeUpdate();
            try (ResultSet generatedKeys = st.getGeneratedKeys()) {
                if (generatedKeys.next()) {
                    idFdP = generatedKeys.getInt(1);
                }           // cheque en BdD: idcheque, fecha_emision, fecha_cobro, idforma_de_pago, monto, N°cheque
                PreparedStatement st2 = co.prepareStatement("INSERT INTO cheque values(default, ?, ?, ?, ?, ?, ?)");

                if (chequeEmisión != null) {
                    st2.setDate(1, new java.sql.Date(chequeEmisión.getTime())); //Igual que en Contable2
                } else //Lo de abajo posiblemente tire exepción
                {
                    st2.setNull(1, java.sql.Types.DATE);
                }

                st2.setDate(2, new java.sql.Date(chequeCobro.getTime())); //Igual que en Contable2
                st2.setInt(3, idFdP); //El Id de forma de pago
                st2.setLong(4, monto);
                st2.setString(5, nCheque);
                st2.setBoolean(6, cobrado);
                st2.executeUpdate();
                // ----------
                co.commit(); //Confirma que las dos operaciones (st y st2) se efectuaron correctamente
            }
        } catch (SQLException ex) {
                JLabel label1 = new JLabelAriel("Error: "+ex.getMessage());
                JOptionPane.showMessageDialog(jFrameCheque, label1, "ERROR", JOptionPane.WARNING_MESSAGE);
            try {
                co.rollback(); //Algo fallo entonces hay que volver las 2 operaciones para atrás (st y st2)
            } catch (SQLException ex1) {
                JLabel label = new JLabelAriel("Error: "+ex1.getMessage());
                JOptionPane.showMessageDialog(jFrameCheque, label, "ERROR", JOptionPane.WARNING_MESSAGE);
            }
            return idFdP = 0;
        } finally {
            if (co != null)
                ;// co.close();  //Me perjudica cuando trato de seguir usando 
        }
        return idFdP;
    }

    @Override
    public boolean sePuedeCerrar(){
        //Se puede agregar alguna otra comprobación
        boolean valor = false;
        JLabelAriel label = new JLabelAriel("La Planilla no fue guardada ¿Desea cerrarla igual?");
       
        if(estaGuardada()){ //La planilla esta guardada, osea que tiene los datos mínimos configurados
            valor = true;
            //Se puede cerrar porque está guardada
        }
        else{
            int rta = JOptionPane.showConfirmDialog(null, label, "ATENCIÓN", JOptionPane.YES_NO_OPTION, JOptionPane.WARNING_MESSAGE);
            if(rta == JOptionPane.YES_OPTION)
                valor = true;
            else
                valor = false;    
        }
        return valor;
    }

    private int maxNumeroPlanilla() { //Retorna el mayor numero de planilla alojado en la Base de Datos
        String consulta = "select max(idplanilla) from planilla";
        int nuevoId = 0;
        try {
            Statement st = this.controlador.obtenerConexion().createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while (rs.next()) {
                nuevoId = rs.getInt(1);
            }
        } catch (SQLException ex) {
            JLabel label = new JLabelAriel("Error: " + ex.getMessage());
            JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);
        }
        return nuevoId;
    }

    private void paraIniciarPlanillaNueva() {
        this.jLabelNumPlanilla.setText(String.valueOf(maxNumeroPlanilla() + 1)); //Agrega el ID que corresponde a esta nueva planilla en el FRAME
        cargarCamiones(0); //El 0 significa que no hay id de Cliente
        this.jDateChooserEntrada.setDate(new Date()); //Fecha de Hoy por defecto
        agregarListenersJComboBox(); //Ahora el de Vehículos solamente
    }

    private void cargarCamiones(int idCliente) {
        String consulta;
        if (idCliente == 0) //No hay cliente seleccionado --> se muestran todos los camiones
        {
            consulta = "SELECT idvehiculo, marca, modelo, patente from vehiculo";
        } else { //Sino --> selecciono los camiones del cliente dado que hay idCliente
            consulta = "select idvehiculo, v.marca, v.modelo, v.patente from vehiculo as v inner join cliente as c "
                    + "on v.idduenio = c.idcliente where v.idduenio = '" + idCliente + "' ";
        }
        cargarVhBdD(consulta);
    }

    
    private void cargarVhBdD(String consulta){
        Connection co = this.controlador.obtenerConexion();
        String marca, modelo, patente;
        // En este método el ActionItemListener debería haber sido quitado
        this.jComboBoxVh.removeAllItems();
        ComboItem cmItem = new ComboItem("0", "<<Seleccione un Camión>>");
        this.jComboBoxVh.addItem(cmItem);
        ComboItem cmItem2 = new ComboItem("0", "--Ver Todos--");
        this.jComboBoxVh.addItem(cmItem2);
        try {
            Statement st = co.createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while (rs.next()) {
                String idVh = String.valueOf(rs.getInt(1));
                marca = rs.getString(2);
                modelo = rs.getString(3);
                patente = rs.getString(4);
                String marcaModelo = marca + " " + modelo;
                ComboItem comboItem = new ComboItem(idVh, marcaModelo + " " + patente); //(clave, valor)
                this.jComboBoxVh.addItem(comboItem);
                this.jComboBoxVh.updateUI();
                //Modificado en "code" --> "type" en parte de Diseño de Netbeans
                //Para obtener el valor por patente:
                /*Object item = comboBox.getSelectedItem();
                String value = ((ComboItem)item).getValue(); ó .getKey() según se prefiera*/
            }
        } catch (SQLException ex) {
            JLabel label = new JLabelAriel("Error: " + ex.getMessage());
            JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);
            //Acá iría la escritura de un log con fecha si es posible. También iría en otros lugares
        }
    }

    private void cargarCliente(String idvh) {
        String consulta = "";
        if (idvh.equals("")) //No hay idVh, se cargan todos los clientes
        {  //Cambiado el "0" por ""
            JOptionPane.showMessageDialog(this, "Debe ingresar una patente "); //this hace referencia al Frame
        } else //Hay una patente --> se carga el cliente específico de ese camión seleccionado
        {
            consulta = "SELECT c.idcliente, p.nombre, p.apellido FROM cliente AS c INNER JOIN persona AS p ON c.idpersona = p.idpersona"
                    + " INNER JOIN vehiculo AS v ON v.idduenio = c.idcliente WHERE v.idvehiculo = '" + idvh + "'";
        }

        cargarClienteBdB(consulta);
    }

    private void cargarClienteBdB(String consulta) {
     
        int idcli;
        //Borro el Action Listeners para que no moleste en el agregado de Datos

        Connection co = this.controlador.obtenerConexion();
        try {
            Statement st = co.createStatement();
            ResultSet rs = st.executeQuery(consulta);
            //Si la patente es "0"

            while (rs.next()) {
                idcli = rs.getInt(1);
                nombre = rs.getString(2); //Nombre y apellido juntos son únicos
                apellido = rs.getString(3);
                this.idCliente = idcli; // Guardo el id para poder usarlo en el insert a la BdD
                this.jTextFieldDueñoCliente.setText(nombre + " " + apellido); //Asi tengo el id del cliente para cuando lo necesite
                //No se muesta el idcli y si se muestra nombre y apellido -- ver clase ComboItem y método toString();
            }
        } catch (SQLException ex) {
            //Acá iría la escritura de un log con fecha si es posible
        }

    }

    private void agregarListenersJComboBox() {

        ItemListener vh = new ItemListener() {
            @Override
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                jComboBoxVhItemStateChanged(evt);
            }
        };

        this.jComboBoxVh.addItemListener(vh);
        this.itemListennerVh = vh;

        ItemListener persona = new ItemListener() {
            @Override
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                jComboBoxPersonaItemStateChanged(evt);
            }
        };
        this.jComboBoxPersona.addItemListener(persona);
        this.itemListennerPersona = persona;

        /*   this.jComboBoxCli.addItemListener(new java.awt.event.ItemListener(){
            @Override
            public void itemStateChanged(java.awt.event.ItemEvent evt){
                jComboBoxCliItemStateChanged(evt);
            }
        }); */
    }

    private void quitarActionListenersJComboBox() {
        // this.jComboBoxCli.removeItemListener(this.itemListennerCli);
        this.jComboBoxVh.removeItemListener(this.itemListennerVh);
        this.jComboBoxPersona.removeItemListener(this.itemListennerPersona);
    }

    /*
    private void filtrarPorPatente(String patenteFiltro){
        //Cargaría los camiones según el filtro por patente - Esta Incompleta
        String marca, modelo, patente;
        ComboItem combo;
        String consulta = "SELECT v.marca, v.modelo FROM vehiculo AS v WHERE v.patente LIKE '"+patenteFiltro+"' ";

        Connection co = this.controlador.obtenerConexion();        
        try {
            Statement st = co.createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while(rs.next()){
            
            }
        } catch (SQLException ex) {
            
        }
    
    }*/
    
    private void cargarTablaReparaciones(int numero) {
        //Método que se encarga de buscar y poner las reparaciones de una planilla en la tabla de Reparacioens
        String consulta = "select r.descripcion, r.importe, r.completada, r.tipo from reparacion AS r "
                + "where idplanilla = '" + numero + "'";
        Object registros[] = new Object[4];
        Connection co = this.controlador.obtenerConexion();
        try {
            Statement st = co.createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while (rs.next()) {
                registros[0] = rs.getString(1);
                registros[1] = rs.getString(4);
                registros[2] = rs.getLong(2);
                registros[3] = rs.getBoolean(3);
                this.tablaReparaciones.addRow(registros);
            }
        } catch (SQLException ex) {
            JLabel label = new JLabelAriel("Error en la carga de Reparaciones " + ex.getMessage());
            JOptionPane.showMessageDialog(null, label, " ERROR ", JOptionPane.WARNING_MESSAGE);
        }

    }

    /*  private void guardarPlanilla() {
        Conecction co = this.controlador.obtenerConexion().prepareStatement(""
                + "INSERT INTO PLANILLA ")
                
    }
     */
    private void cargarPersonas(String idpersona) {
        //Crea la consulta correspondiente para completar el ComboBoxPersona. -1 Los choferes, 0 Todas las personas
        String consulta = "";
        if (idpersona.equals("-1")) //No hay persona seleccionada, se cargan todos las personas
        {
            consulta = "SELECT p.nombre, p.apellido, c.apodo, p.idpersona FROM persona AS p LEFT JOIN chofer AS c "
                    + "ON p.idpersona = c.idpersona";
        }else if(idpersona.equals("0")){ //Se selecciona para cargar los choferes unicamente
            consulta = "SELECT p.nombre, p.apellido, c.apodo, p.idpersona FROM persona AS p inner JOIN chofer AS c "
                    + "ON p.idpersona = c.idpersona";
        }
/*       
        consulta = "SELECT p.nombre, p.apellido, c.apodo, p.idpersona FROM persona AS p inner join planilla as pl on "
                + "pl.idpersona = p.idpersona inner join chofer as c on c.idpersona = p.idpersona "
                + "where pl.idplanilla = '"+idplanilla+"' ";
        */
        cargarPersonasBdD(consulta);
    }

    private void cargarPersonasBdD(String consulta) {
        //Quite la visibilidad del jComboBox de Persona (chofer) solamente pongo el nombre y apodo en un jLabelNombreApodo
        Connection co = this.controlador.obtenerConexion();
        this.jComboBoxPersona.removeAllItems();
        ComboItem cItem = new ComboItem("-1", "--Todos las Personas--");
        this.jComboBoxPersona.addItem(cItem);
        ComboItem cItem2 = new ComboItem("0", "--Todas las Choferes--");
        this.jComboBoxPersona.addItem(cItem2);
        try {
            Statement st = co.createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while (rs.next()) {
                this.nombre = rs.getString(1);
                this.apellido = rs.getString(2);
                String apo2 = rs.getString(3);
                if(apo2 == null)
                    this.apodo = "";
                else
                    this.apodo = rs.getString(3); //Tiene apodo
                int idpersona = rs.getInt(4);
                ComboItem comboItem = new ComboItem(String.valueOf(idpersona), this.nombre + " " + this.apellido + " " + this.apodo);
                this.jComboBoxPersona.addItem(comboItem);
            }
        } catch (SQLException ex) {
            JLabel label = new JLabelAriel("Error método cargarPersonasBdD: " + ex.getMessage());
            JOptionPane.showMessageDialog(null, label, " ERROR ", JOptionPane.WARNING_MESSAGE);
        }
    }

    private void cosasParaPlanillaAModificar(int numero) {
        //Carga los datos de la planilla a modificar.
        tablaReparaciones.setColumnIdentifiers(getColumnas());
        this.jButtonGuardar.setText("Actualizar");
        // Quito o modifico lo que es de acuerdo a Nueva Planilla
        this.jLabelFPatente.setText("");
        this.jTextFieldFPatente.setVisible(false);

        this.jComboBoxVh.setVisible(false);
        this.jButtonFVh.setVisible(false);
        this.jComboBoxPersona.setVisible(false);
        this.jTextFieldFPersona.setVisible(false);
        this.jButtonFPer.setVisible(false);
        //--

        //el numero representa número de planilla y sirve para buscar toda la informacion referida a la misma
        llenarCampos(numero);
        this.cargarImporte();
        cargarTablaPagos(numero);
        cargarTablaReparaciones(numero); //Cargo las reparaciones con el numero de planillas
        this.jTableReparaciones.getTableHeader().setFont(new Font("SansSerif", Font.BOLD, 15));
        cargarPersonas("-1"); //Si es nueva planilla va un -1 que carga --> todas los choferes
        this.jLabelNombreApodo.setText(this.nombre+" "+this.apellido+" 'alias' "+this.apodo); //Sí o sí dsps de la anterior línea
        if (this.jComboBoxPersona.getItemCount() > 1) {
            this.jComboBoxPersona.setSelectedIndex(1);
        }
    }

    /*   @Override
   public void limpiarDatos(){
        //Necesario para cuando cierre y habra otra vez nueva planilla y no queden los mismos datos que antes
      //  this.cargarPersonas("0");
      // this.cargarCamiones("0");
        this.jTextFieldDueñoCliente.setText("");
        this.jTextFieldFPatente.setText("");
        this.jTextFieldDescripcion.setText("");
        this.jTextFieldFPersona.setText("");
        this.jTablePagos.removeAll();
    } */

    private void cargarImporte(){
        //Cargar el importe total de las reparaciones en un JTextField
        long montoPorReparaciones = this.montoPorReparaciones();
        //this.jTextFieldImporte.setText(""+montoPorReparaciones);
        Object registro[] = new Object[4];
        registro[0] = "IMPORTE";
        registro[3] = montoPorReparaciones;
        this.tablaReparaciones.addRow(registro);
    }
    
    @Override
    public void onFocus() {
        //Tendría que cargar datos que pudieron ser modificados antes del onFocus();
        //Por ahora ponemos que se carguen las reparaciones
        /*  this.jTableReparaciones.removeRowSelectionInterval(0, this.jTableReparaciones.getRowCount()-1); //Elimino todas las filas ...
               --NO ANDUVO LO DE ARRIBA  */
        DefaultTableModel dtm = (DefaultTableModel) this.jTableReparaciones.getModel();
        dtm.setRowCount(0);  //Magicamente anduvo y sirve para eliminar las filas de la tabla
        this.cargarTablaReparaciones(Integer.valueOf(this.jLabelNumPlanilla.getText()));
        DefaultTableModel dtm2 = (DefaultTableModel) this.jTablePagos.getModel();
        dtm2.setRowCount(0);  //Magicamente anduvo y sirve para eliminar las filas de la tabla
        this.cargarTablaPagos(Integer.valueOf(this.jLabelNumPlanilla.getText()));

        cargarImporte();
    }

    private void modificarCheque(int idCheque) {
        // Tenemos que obtener los datos y cargar la vista
        this.jCheckBoxChequeNuevo.setSelected(false);
        this.jCheckBoxChequeNuevo.setEnabled(false);
        this.jLabelIdCheque.setText(""+idCheque);
        //-----------
        String consulta = "SELECT * from cheque where cheque.idcheque = '"+idCheque+"' "; //Es lo que realmente aparece en la tabla
        try{
            Statement st = this.controlador.obtenerConexion().createStatement();
            ResultSet rs = st.executeQuery(consulta);
            while(rs.next()){
                this.jDateChooserChCobro.setDate(rs.getDate(3));
                this.jDateChooserChEmision.setDate(rs.getDate(2));
    //    this.jTextFieldMontoCheque.setText(""+rs.getLong(5)); //Problemas porque es un RestrictedTextField -- queda vacío
                this.montoCheque = new RestrictedTextField(this.jTextFieldMontoCheque);
                this.montoCheque.setOnlyNums(true);
                this.jTextFieldNCheque.setText(rs.getString(6));
                this.jCheckBoxChCobrado.setSelected(rs.getBoolean(7));
            }
        }catch(SQLException ex){
            JLabel label = new JLabelAriel("Error: " + ex.getMessage());
            JOptionPane.showMessageDialog(null, label, " ERROR ", JOptionPane.WARNING_MESSAGE);
        }
        this.jFrameCheque.setVisible(true);
    }

    private void modificarContado(int idPago) {
        //Falta completar
        //--------Creando la vista 
        this.jFrameContado.setVisible(true);
        this.jButtonAgregarContado.setText("Actualizar");
        //------------ DATOS PARA PODER ACTUALIZAR DESPUES---------------
        this.jRadioButtonNuevoPago.setSelected(false); //Porque es para modificar
        this.jRadioButtonNuevoPago.setVisible(false); //Para que se disimule
        this.jLabelIdPago.setText(""+idPago);
        this.jLabelId.setVisible(true);
        //----------------------------------------------------
        // Acá iria la consulta para rellenar los 2 siguientes datos:
        cargarDatosContado(idPago);
        this.montoContado = new RestrictedTextField(this.jTextFieldMontoContado);
        this.montoContado.setOnlyNums(true);  //Hace que se borre el monto
    }

    private void cargarDatosContado(int idPago){
        
        String eee = "SELECT c.monto, c.fecha FROM contado as c WHERE c.idcontado = '"+idPago+"' ";
        try {
            Statement st = this.controlador.obtenerConexion().createStatement();
            ResultSet rs = st.executeQuery(eee);
            while(rs.next()){
                long monto = rs.getLong(1);
                Date fecha = rs.getDate(2);
                this.jTextFieldMontoContado.setText(""+monto);
                this.jDateChooserContado.setDate(fecha);
            }  
        } catch (SQLException ex) {
            JLabel label = new JLabelAriel("Error en la carga de Datos " + ex.getMessage());
            JOptionPane.showMessageDialog(null, label, " ERROR ", JOptionPane.WARNING_MESSAGE);
        }

    }

    private void actualizarChequeBdB(int idCheque, Date chequeCobro, String numeroCheque, long monto, Date chequeEmision, boolean cobrado) {
        //
        try {
            Connection co = this.controlador.obtenerConexion();
            PreparedStatement ps = co.prepareStatement("UPDATE cheque SET fecha_emison = ?, fecha_cobro = ?, monto = ?, "
                    + "numerocheque = ?, cobrado = ? WHERE idcheque = ?");
            if (chequeEmision != null) {
                ps.setDate(1, new java.sql.Date(chequeEmision.getTime())); //Igual que en Contable2
            } else
            {
                ps.setNull(1, java.sql.Types.DATE); //Anda bien
            }
            ps.setDate(2, new java.sql.Date(chequeCobro.getTime()));
            ps.setLong(3, monto);
            ps.setString(4, numeroCheque);
            ps.setBoolean(5, cobrado);
            ps.setInt(6, idCheque);
            ps.executeUpdate();
        } catch (SQLException ex) {
            JLabel label = new JLabelAriel("Error al actualizar el cheque: "+ex.getMessage());
            JOptionPane.showMessageDialog(null, label, "ERROR", JOptionPane.WARNING_MESSAGE);
        }
    }
}
